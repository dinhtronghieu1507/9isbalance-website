<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công Cụ Phân Tích Sức Khỏe - 9isBalance</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/59qtkKWY/AVA-BETA.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007BFF;
            --secondary-color: #00C6FF;
            --dark-color: #2c3e50;
            --light-color: #ffffff;
            --text-color: #4a4a4a;
            --gray-bg: #f0f4f8;
            --border-radius: 20px;
            --shadow: 0 15px 35px rgba(60, 90, 130, 0.1);
            --status-underweight: #3498db;
            --status-normal: #28a745;
            --status-overweight: #f1c40f;
            --status-obese: #e74c3c;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--gray-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: 10px;
        }
        .wrapper { max-width: 1200px; margin: 0 auto; }
        
        .main-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px 30px 20px; }
        .logo { font-size: 1.8em; font-weight: 800; color: var(--dark-color); text-decoration: none; }
        
        .main-nav { display: flex; align-items: center; }
        .main-nav a, .dropdown-btn { text-decoration: none; color: var(--dark-color); margin-left: 25px; font-weight: 600; padding: 8px 12px; border-radius: 8px; transition: all 0.3s ease; cursor: pointer; }
        .main-nav a:hover, .dropdown-btn:hover { color: var(--primary-color); }
        .main-nav a.active, .dropdown-btn.active { background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: var(--light-color); }
        
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; background-color: var(--light-color); min-width: 220px; box-shadow: 0 8px 16px 0 rgba(0,0,0,0.1); z-index: 1; border-radius: var(--border-radius); margin-top: 10px; padding: 5px 0; border: 1px solid #eee; }
        .dropdown-content a { color: var(--dark-color); padding: 12px 16px; text-decoration: none; display: block; margin-left: 0; border-radius: 0; font-size: 0.95em; }
        .dropdown-content a:hover { background-color: #f1f1f1; }
        .dropdown:hover .dropdown-content { display: block; }
        
        .app-grid { display: grid; grid-template-columns: 380px 1fr; gap: 30px; align-items: flex-start; }
        .card { background: var(--light-color); border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 30px; }
        
        .calculator-form h1 { font-size: 1.8em; font-weight: 800; color: var(--dark-color); margin-bottom: 25px; }
        .form-group { margin-bottom: 18px; }
        .form-group label { font-weight: 700; color: var(--dark-color); display: flex; align-items: center; margin-bottom: 10px; }
        .form-group label span { margin-right: 8px; font-size: 1.2em; color: var(--primary-color); }
        
        .input-text, .input-select { width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #dfe6e9; font-family: 'Be Vietnam Pro', sans-serif; font-size: 1em; transition: all 0.3s ease; }
        .input-text:focus, .input-select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15); }
        .input-radio-group { display: flex; gap: 20px; }
        
        .btn { padding: 14px 30px; border: none; border-radius: 50px; font-size: 1.1em; font-weight: 700; cursor: pointer; transition: all 0.3s ease; width: 100%; background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: var(--light-color); box-shadow: 0 8px 20px rgba(0, 123, 255, 0.3); margin-top: 10px; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0, 123, 255, 0.4); }
        .btn:disabled { background-image: none; background-color: #bdc3c7; cursor: not-allowed; box-shadow: none; transform: none; }

        .results-container { display: none; grid-template-columns: 1fr 1fr; gap: 25px; }
        .results-container.visible { display: grid; }
        .result-card { background: var(--light-color); border-radius: var(--border-radius); box-shadow: var(--shadow); padding: 25px; animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .result-card h3 { font-size: 1.1em; font-weight: 700; color: var(--dark-color); margin-bottom: 15px; text-align: center; }
        
        .bmi-card-content { text-align: center; }
        .bmi-main-result { display: flex; justify-content: center; align-items: baseline; margin-bottom: 15px; }
        #bmi-value { font-size: 4em; font-weight: 800; line-height: 1; }
        #bmi-interpretation { font-weight: 700; font-size: 1.5em; margin-left: 10px; }
        .bmi-progress-bar { height: 10px; background-color: #eef5f9; border-radius: 10px; overflow: hidden; position: relative; }
        #bmi-progress-value { height: 100%; width: 0; border-radius: 10px; transition: width 1.5s ease-out, background-color 0.5s ease; }
        .bmi-summary { font-size: 0.9em; margin-top: 10px; }
        
        .calories-card { background: rgba(44, 62, 80, 0.8); backdrop-filter: blur(10px); color: var(--light-color); display: flex; flex-direction: column; justify-content: center; }
        .tdee-main { text-align: center; margin-bottom: 20px; }
        .tdee-main .icon { font-size: 2em; line-height: 1; opacity: 0.8; }
        .tdee-main .value { font-size: 3.5em; font-weight: 800; color: var(--light-color); line-height: 1.1; }
        .tdee-main .label { font-size: 0.9em; opacity: 0.8; font-weight: 600; }
        .bmr-secondary { text-align: center; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .bmr-secondary .value { font-size: 1.8em; font-weight: 700; }
        .bmr-secondary .label { font-size: 0.9em; opacity: 0.7; }

        .advice-card { grid-column: 1 / -1; }
        .macros-card, .cta-card { grid-column: 1 / -1; }
        .detail-item { margin-bottom: 25px; }
        .detail-item p, .detail-item ul { font-size: 0.95em; opacity: 0.9; line-height: 1.7; }
        .detail-item ul { list-style-position: inside; padding-left: 10px;}
        .detail-item-title { font-size: 1.1em; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; }
        .detail-item-title span { margin-right: 12px; font-size: 1.2em; }
        .tdee-macro-table { width: 100%; border-collapse: collapse; text-align: center; }
        .tdee-macro-table th, .tdee-macro-table td { padding: 12px; border-bottom: 1px solid var(--gray-bg); }
        .tdee-macro-table th { font-weight: 700; font-size: 0.9em; }
        .tdee-macro-table tr:last-child td { border: none; }
        .tdee-macro-table .goal-col { font-weight: 600; }
        
        .cta-card { background-image: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: var(--light-color); text-align: center; }
        .cta-card p { margin-bottom: 15px; font-size: 1.1em; }
        .cta-btn { text-decoration: none; color: var(--primary-color); background: var(--light-color); padding: 10px 25px; border-radius: 50px; font-weight: 700; transition: all 0.3s ease; }
        .cta-btn:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        .hidden { display: none; }

        /* ===== CSS CHO POP-UP ỦNG HỘ ===== */
        .modal-overlay { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.3s; }
        .modal-content { background-color: #fff; margin: 10% auto; padding: 25px; border-radius: var(--border-radius); width: 90%; max-width: 400px; text-align: center; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: slideIn 0.4s ease-out; }
        @keyframes slideIn { from {transform: translateY(-50px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        .modal-content img { max-width: 100%; height: auto; border-radius: 10px; }
        .close-button { color: #aaa; position: absolute; top: 15px; right: 20px; font-size: 28px; font-weight: bold; transition: color 0.3s; }
        .close-button:hover, .close-button:focus { color: #333; text-decoration: none; cursor: pointer; }
        
        @media (max-width: 900px) {
            .app-grid, .results-container { grid-template-columns: 1fr; }
            .advice-card, .macros-card, .cta-card { grid-column: auto; }
            .main-header { flex-direction: column; gap: 15px; }
            .main-nav { flex-direction: column; width: 100%; gap: 10px; }
            .main-nav a, .dropdown { margin-left: 0; width: 100%; text-align: center; }
            .main-nav a.active { background-color: var(--primary-color); }
            .dropdown-content { display: none; position: static; box-shadow: none; border: none; background-color: var(--gray-bg); width: 100%; padding-top: 10px; }
            .dropdown:hover .dropdown-content, .dropdown-btn:focus + .dropdown-content { display: flex; flex-direction: column; gap: 5px; }
            .dropdown-content a { background-color: var(--light-color); border-radius: 8px; }
            .card { padding: 20px; }
            .calculator-form h1 { font-size: 1.6em; }
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-098Y1X0LPH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-098Y1X0LPH');
    </script>
</head>
<body>
    <div class="wrapper">
        <header class="main-header">
            <a href="index.html" class="logo">9isBalance</a>
            <nav class="main-nav">
                <div class="dropdown">
                    <span class="dropdown-btn">Dịch vụ ▼</span>
                    <div class="dropdown-content">
                        <a href="index.html">HL Cá nhân</a>
                        <a href="huan-luyen-nang-cao.html">HL Nâng cao</a>
                        <a href="tri-lieu-phuc-hoi.html">Trị liệu & Phục hồi</a>
                        <a href="tu-van-online.html">Tư vấn Online</a>
                    </div>
                </div>
                <a href="cong-cu-tinh-toan.html" class="active">Công cụ Sức khỏe</a>
                <a href="gioi-thieu.html">Về tôi</a>
                <a href="dang-ky.html">Đăng ký</a>
            </nav>
        </header>

        <div class="app-grid">
            <div class="card calculator-form">
                <h1>Phân Tích Sức Khỏe Toàn Diện</h1>
                <div class="form-group"><label for="gender"><span>👤</span>Giới tính</label><div class="input-radio-group"><label><input type="radio" name="gender" value="male" checked> Nam</label><label><input type="radio" name="gender" value="female"> Nữ</label></div></div>
                <div class="form-group"><label for="age"><span>🎂</span>Tuổi</label><input type="number" id="age" class="input-text" placeholder="Nhập tuổi của bạn" min="15" max="100"></div>
                <div class="form-group"><label for="height"><span>📏</span>Chiều cao (cm)</label><input type="number" id="height" class="input-text" placeholder="Ví dụ: 175" min="100" max="220"></div>
                <div class="form-group"><label for="weight"><span>⚖️</span>Cân nặng (kg)</label><input type="number" id="weight" class="input-text" placeholder="Ví dụ: 68.5" min="30" max="180"></div>
                <div class="form-group"><label for="bodyfat"><span>🔥</span>Tỷ lệ mỡ (%) (Tùy chọn)</label><input type="number" id="bodyfat" class="input-text" placeholder="Để trống nếu không biết" min="3" max="50"></div>
                <div class="form-group">
                    <label for="activity"><span>🏃</span>Mức độ vận động</label>
                    <select id="activity" class="input-select">
                        <option value="1.2">Ít vận động (làm việc văn phòng)</option>
                        <option value="1.375" selected>Vận động nhẹ (tập 1-3 ngày/tuần)</option>
                        <option value="1.55">Vận động vừa (tập 3-5 ngày/tuần)</option>
                        <option value="1.725">Vận động nhiều (tập 6-7 ngày/tuần)</option>
                        <option value="1.9">Vận động rất nhiều (cường độ cao & công việc thể chất)</option>
                    </select>
                </div>
                <button id="calculate-btn" class="btn">Phân Tích Ngay</button>
            </div>
            
            <div class="right-panel">
                <div class="card welcome-panel" id="welcome-panel">
                    <div class="icon" style="font-size: 3.5em; line-height: 1; margin-bottom: 15px; background: -webkit-linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">💡</div>
                    <h2 style="font-size: 1.5em; font-weight: 700; color: var(--dark-color); margin-bottom: 10px;">Bắt đầu Hành trình Sức khỏe</h2>
                    <p style="margin-bottom: 20px;">Nhập các thông số của bạn để nhận một bản phân tích toàn diện và những lời khuyên được cá nhân hóa, giúp bạn hiểu rõ hơn về cơ thể mình.</p>
                    <h3 style="font-size: 1.1em; font-weight: 700; color: var(--dark-color); margin-bottom: 10px;">Bạn sẽ nhận được:</h3>
                    <ul style="list-style: none; padding-left: 0; text-align: left;">
                        <li style="margin-bottom: 10px; font-weight: 600; display: flex; align-items: center;"><span style="color: var(--primary-color); font-weight: 800; margin-right: 10px;">✓</span>Chỉ số BMI & Tình trạng cơ thể</li>
                        <li style="margin-bottom: 10px; font-weight: 600; display: flex; align-items: center;"><span style="color: var(--primary-color); font-weight: 800; margin-right: 10px;">✓</span>Năng lượng tiêu thụ hàng ngày (TDEE)</li>
                        <li style="margin-bottom: 10px; font-weight: 600; display: flex; align-items: center;"><span style="color: var(--primary-color); font-weight: 800; margin-right: 10px;">✓</span>Lời khuyên chi tiết từ chuyên gia</li>
                        <li style="margin-bottom: 10px; font-weight: 600; display: flex; align-items: center;"><span style="color: var(--primary-color); font-weight: 800; margin-right: 10px;">✓</span>Gợi ý Macros cho từng mục tiêu</li>
                    </ul>
                </div>

                <div class="results-container" id="results-container">
                    <div class="result-card bmi-card-content">
                        <h3>Chỉ số BMI</h3>
                        <div class="bmi-main-result">
                            <span id="bmi-value">--</span>
                            <span id="bmi-interpretation"></span>
                        </div>
                        <div class="bmi-progress-bar">
                            <div id="bmi-progress-value"></div>
                        </div>
                        <p class="bmi-summary" id="bmi-summary-text"></p>
                    </div>
                    <div class="result-card calories-card">
                        <div class="tdee-main"><div class="icon">🔥</div><div class="value" id="tdee-value">--</div><div class="label">TDEE (Năng lượng Duy trì)</div></div>
                        <div class="bmr-secondary"><div class="label">❤️ Năng lượng Cơ bản (BMR)</div><div class="value" id="bmr-value">--</div></div>
                    </div>
                    <div class="result-card advice-card">
                        <h3>Lời khuyên dành cho bạn</h3>
                        <div class="detail-item">
                            <h4 class="detail-item-title"><span>🚨</span>Mức độ cảnh báo</h4>
                            <p id="bmi-warning"></p>
                        </div>
                        <div class="detail-item">
                            <h4 class="detail-item-title"><span>💪</span>Lời khuyên hành động</h4>
                            <div id="bmi-action"></div>
                        </div>
                        <div class="detail-item">
                            <h4 class="detail-item-title"><span>🥗</span>Khuyến nghị chung</h4>
                            <p id="bmi-recommendation"></p>
                        </div>
                    </div>
                    <div class="result-card macros-card">
                        <h3>Bảng Macros Gợi ý</h3>
                        <table class="tdee-macro-table">
                            <thead><tr><th>Mục tiêu</th><th>Calo</th><th>Protein (g)</th><th>Carbs (g)</th><th>Fat (g)</th></tr></thead>
                            <tbody id="macro-results-body"></tbody>
                        </table>
                    </div>
                    <div class="result-card cta-card" id="cta-card">
                        <p id="cta-text"></p>
                        <a href="dang-ky.html" id="cta-link" class="cta-btn"></a>
                    </div>
                </div>
            </div>
        </div>

        <div style="background: linear-gradient(45deg, #eef5f9, #d9e8f6); margin-top: 30px; text-align: center; padding: 40px 25px; border-radius: var(--border-radius); animation: fadeIn 0.5s ease-out forwards;">
            <h3 style="font-size: 1.6em; color: var(--dark-color); margin-bottom: 15px;">Thấy công cụ này hữu ích?</h3>
            <p style="max-width: 600px; margin: 0 auto 25px; font-size: 1.05em; line-height: 1.7; opacity: 0.85;">
                Sự ủng hộ của bạn, dù là nhỏ nhất, cũng là động lực lớn giúp tôi duy trì và phát triển thêm nhiều công cụ miễn phí khác cho cộng đồng.
            </p>
            <button id="donate-button" class="btn" style="display: inline-block; width: auto; text-decoration: none; padding: 12px 30px;">
                Mời tôi một ly cà phê ☕
            </button>
        </div>
        
        <p style="text-align: center; margin-top: 20px; font-size: 0.9em; color: #7f8c8d;">Lưu ý: Các kết quả tính toán chỉ mang tính chất tham khảo. Hãy liên hệ chuyên gia để có lời khuyên chính xác nhất.</p>
    </div>

    <div id="qr-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h4 style="margin-bottom: 15px; font-size: 1.2em;">Quét mã để ủng hộ</h4>
            <img src="https://i.postimg.cc/CMt81Z5n/TCB-QR-STORE-202522294958.jpg" alt="Mã QR ủng hộ">
        </div>
    </div>
    
    <script>
        const calculateBtn = document.getElementById('calculate-btn');
        const welcomePanel = document.getElementById('welcome-panel');
        const resultsContainer = document.getElementById('results-container');

        // ===============================================
        // ===== BẮT ĐẦU CÁC HÀM JAVASCRIPT ĐẦY ĐỦ =====
        // ===============================================
        function animateValue(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                element.textContent = Math.floor(progress * (end - start) + start).toLocaleString('vi-VN');
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function animateDecimal(element, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                element.textContent = (progress * (end - start) + start).toFixed(1);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function getBmiStatus(bmi) {
            if (bmi < 18.5) {
                return {
                    text: 'Thiếu cân',
                    className: 'status-underweight',
                    summary: 'Cơ thể bạn đang không có đủ năng lượng và dưỡng chất.',
                    warning: 'CAO ĐẾN BÁO ĐỘNG ĐỎ. Đây không phải là một vóc dáng "mảnh mai" đáng ao ước mà là một tình trạng sức khỏe đáng báo động. Cơ thể bạn đang không có đủ năng lượng và dưỡng chất để duy trì các chức năng sống cơ bản một cách tối ưu. Đặc biệt với BMI dưới 17 (Gầy độ II, III): Đây là mức BÁO ĐỘNG ĐỎ. Nguy cơ suy giảm hệ miễn dịch, loãng xương, rụng tóc, mất cơ, rối loạn nội tiết (ở phụ nữ có thể gây mất kinh), và suy nhược toàn thân là rất cao.',
                    action: `<ul>
                                <li><strong>Gặp chuyên gia y tế NGAY LẬP TỨC:</strong> Bước đầu tiên và quan trọng nhất là phải đi khám bác sĩ để loại trừ các nguyên nhân bệnh lý tiềm ẩn gây sụt cân hoặc khó tăng cân (ví dụ: bệnh về tuyến giáp, rối loạn tiêu hóa, nhiễm ký sinh trùng...).</li>
                                <li><strong>Tăng cường dinh dưỡng CHẤT LƯỢNG:</strong> Mục tiêu không phải là ăn thật nhiều đồ ngọt hay chất béo bão hòa. Hãy tập trung tăng lượng calo từ các nguồn thực phẩm lành mạnh:
                                    <ul>
                                        <li><strong>Protein:</strong> Tăng cường thịt nạc, cá, trứng, sữa, các loại đậu, hạt để xây dựng lại khối cơ bắp đã mất.</li>
                                        <li><strong>Chất béo tốt:</strong> Bổ sung quả bơ, dầu ô liu, các loại hạt (óc chó, hạnh nhân), cá béo (cá hồi, cá trích).</li>
                                        <li><strong>Carbohydrate phức hợp:</strong> Chọn ngũ cốc nguyên hạt, yến mạch, khoai lang, gạo lứt để cung cấp năng lượng bền bỉ.</li>
                                    </ul>
                                </li>
                                <li><strong>Chia nhỏ bữa ăn:</strong> Ăn 5-6 bữa nhỏ trong ngày thay vì 3 bữa lớn. Điều này giúp bạn không cảm thấy quá no và cơ thể dễ hấp thu dinh dưỡng hơn. Bổ sung các bữa phụ bằng sữa chua, sinh tố, các loại hạt.</li>
                                <li><strong>Tập luyện để xây dựng cơ bắp:</strong> Đừng chỉ tập các bài cardio. Hãy kết hợp các bài tập kháng lực (nâng tạ, gym) dưới sự hướng dẫn của huấn luyện viên để đảm bảo cân nặng tăng lên là cơ bắp, không phải mỡ.</li>
                             </ul>`,
                    recommendation: 'Tăng cân lành mạnh là một quá trình đòi hỏi sự kiên nhẫn, đôi khi còn khó hơn giảm cân. Hãy đặt mục tiêu tăng từ 0.2 - 0.5 kg mỗi tuần. Theo dõi tiến trình, lắng nghe cơ thể và đừng ngần ngại tìm kiếm sự giúp đỡ từ chuyên gia dinh dưỡng.',
                    ctaText: 'Cần một lộ trình tăng cân an toàn và hiệu quả?',
                    ctaButton: 'Tư vấn ngay',
                    ctaLinkHref: 'dang-ky.html?service=hl-ca-nhan'
                };
            } else if (bmi >= 18.5 && bmi < 24.9) {
                return {
                    text: 'Bình thường',
                    className: 'status-normal',
                    summary: 'Chúc mừng! Bạn đang ở mức cân nặng lý tưởng.',
                    warning: 'AN TOÀN - LÝ TƯỞNG. Xin chúc mừng! Bạn đang ở trong ngưỡng cân nặng khỏe mạnh, giúp giảm thiểu nguy cơ mắc các bệnh mãn tính liên quan đến cân nặng. Đây là một thành tựu đáng tự hào.',
                    action: `<ul>
                                <li><strong>Duy trì và Phát huy:</strong> Mục tiêu chính của bạn bây giờ là duy trì lối sống tích cực này. Đừng xem đây là lý do để chủ quan.</li>
                                <li><strong>Ăn uống cân bằng:</strong> Tiếp tục duy trì một chế độ ăn đa dạng, giàu rau xanh, trái cây, protein nạc và ngũ cốc nguyên hạt. Hãy chú ý đến việc kiểm soát lượng đường, muối và thực phẩm chế biến sẵn.</li>
                                <li><strong>Vận động đều đặn:</strong> Duy trì ít nhất 150 phút hoạt động thể chất cường độ vừa phải mỗi tuần (như đi bộ nhanh, đạp xe, bơi lội).</li>
                             </ul>`,
                    recommendation: 'Chỉ số BMI bình thường không có nghĩa là bạn hoàn toàn khỏe mạnh. Hãy quan tâm thêm đến các yếu tố khác như tỷ lệ mỡ/cơ, số đo vòng eo, chất lượng giấc ngủ và sức khỏe tinh thần. Đây là giai đoạn vàng để củng cố các thói quen tốt, tạo nền tảng vững chắc cho sức khỏe lâu dài.',
                    ctaText: 'Bạn muốn nâng cao thể lực và vóc dáng hơn nữa?',
                    ctaButton: 'Khám phá các dịch vụ',
                    ctaLinkHref: 'index.html'
                };
            } else if (bmi >= 25 && bmi < 29.9) {
                return {
                    text: 'Thừa cân',
                    className: 'status-overweight',
                    summary: 'Bạn nên xem xét việc giảm cân để cải thiện sức khỏe.',
                    warning: 'CẢNH BÁO VÀNG - CẦN CAN THIỆP. Đây là "đèn vàng" trên hành trình sức khỏe của bạn. Bạn chưa bị béo phì, nhưng cơ thể đã bắt đầu tích trữ mỡ thừa ở mức có thể gây hại. Nguy cơ phát triển các bệnh như cao huyết áp, mỡ máu, kháng insulin (tiền tiểu đường) và bệnh tim mạch đã bắt đầu tăng lên.',
                    action: `<ul>
                                <li><strong>HÀNH ĐỘNG NGAY, ĐỪNG CHẦN CHỪ:</strong> Đây là thời điểm tốt nhất để thay đổi. Việc giảm một vài kg ở giai đoạn này sẽ dễ dàng và hiệu quả hơn rất nhiều so với khi đã bị béo phì.</li>
                                <li><strong>Rà soát lại chế độ ăn:</strong> Ghi lại nhật ký ăn uống trong 3-5 ngày để xem bạn đang ăn gì. Thường thì vấn đề nằm ở đồ ăn vặt, nước ngọt, đồ ăn nhanh và khẩu phần ăn quá lớn.</li>
                                <li><strong>Cắt giảm:</strong> Đường, đồ uống có cồn, thực phẩm chiên rán, tinh bột tinh chế (bánh mì trắng, bún, phở).</li>
                                <li><strong>Tăng cường:</strong> Chất xơ từ rau củ, salad, trái cây ít ngọt để bạn no lâu hơn. Uống đủ nước.</li>
                                <li><strong>Tăng cường vận động:</strong> Nếu bạn chưa vận động, hãy bắt đầu bằng 30 phút đi bộ mỗi ngày. Nếu đã có, hãy tăng dần thời gian hoặc cường độ. Kết hợp cả cardio (đốt mỡ) và tập kháng lực (xây dựng cơ để tăng cường trao đổi chất).</li>
                                <li><strong>Kiểm soát khẩu phần:</strong> Ăn bằng bát/đĩa nhỏ hơn. Ăn chậm, nhai kỹ. Dừng lại khi cảm thấy no khoảng 80%.</li>
                             </ul>`,
                    recommendation: 'Hãy đặt mục tiêu giảm cân thực tế và bền vững, khoảng 5-10% trọng lượng cơ thể trong 6 tháng. Sự thay đổi nhỏ nhưng nhất quán sẽ tạo ra kết quả lớn.',
                    ctaText: 'Bắt đầu hành trình giảm cân của bạn ngay hôm nay!',
                    ctaButton: 'Đăng ký huấn luyện',
                    ctaLinkHref: 'dang-ky.html?service=hl-ca-nhan'
                };
            } else {
                return {
                    text: 'Béo phì',
                    className: 'status-obese',
                    summary: 'Mức cân nặng của bạn có nguy cơ cao ảnh hưởng đến sức khỏe.',
                    warning: 'BÁO ĐỘNG ĐỎ - NGUY HIỂM. Đây không còn là vấn đề về ngoại hình, mà là một TÌNH TRẠNG BỆNH LÝ cần được can thiệp y tế nghiêm túc. Mỗi cấp độ béo phì tăng lên, nguy cơ mắc các bệnh nguy hiểm như tiểu đường type 2, bệnh tim mạch, đột quỵ, ngưng thở khi ngủ, bệnh xương khớp và một số loại ung thư sẽ tăng theo cấp số nhân.',
                    action: `<ul>
                                <li><strong>TÌM KIẾM SỰ TRỢ GIÚP Y TẾ CHUYÊN NGHIỆP:</strong> Bạn không nên chiến đấu một mình. Hãy đến gặp bác sĩ để được đánh giá sức khỏe tổng thể, làm các xét nghiệm cần thiết (đường huyết, mỡ máu, chức năng gan, tim mạch...). Bác sĩ và chuyên gia dinh dưỡng sẽ xây dựng một phác đồ điều trị an toàn và phù hợp cho bạn.</li>
                                <li><strong>Thay đổi dinh dưỡng toàn diện:</strong> Bạn cần một kế hoạch ăn uống có cấu trúc chặt chẽ, được cá nhân hóa, tạo ra sự thâm hụt calo an toàn. Điều này đòi hỏi phải loại bỏ gần như hoàn toàn thực phẩm công nghiệp, đồ ngọt, chất béo chuyển hóa và kiểm soát chặt chẽ khẩu phần ăn.</li>
                                <li><strong>Vận động có hướng dẫn:</strong> Bắt đầu từ từ với các bài tập cường độ thấp và ít tác động lên khớp như đi bộ, bơi lội, đạp xe tại chỗ. Khi thể lực cải thiện, bạn có thể tăng dần cường độ dưới sự giám sát để tránh chấn thương, đặc biệt là các vấn đề về khớp gối và cột sống.</li>
                                <li><strong>Can thiệp tâm lý:</strong> Đôi khi ăn uống quá độ liên quan đến các vấn đề tâm lý như căng thẳng, trầm cảm. Việc tư vấn tâm lý có thể giúp giải quyết gốc rễ của vấn đề.</li>
                                <li><strong>Cân nhắc các phương pháp khác:</strong> Đối với béo phì độ II, III, nếu việc thay đổi lối sống không hiệu quả, bác sĩ có thể thảo luận về việc sử dụng thuốc hoặc các phương pháp can thiệp ngoại khoa.</li>
                             </ul>`,
                    recommendation: 'Hành trình thoát khỏi béo phì là một con đường dài và đầy thử thách, đòi hỏi sự quyết tâm sắt đá. Hãy tập trung vào mục tiêu cải thiện sức khỏe, không chỉ là con số trên bàn cân. Mỗi kg giảm được đều là một chiến thắng lớn cho trái tim, mạch máu và toàn bộ cơ thể của bạn.',
                    ctaText: 'Nhận sự hỗ trợ chuyên nghiệp để thay đổi cuộc sống!',
                    ctaButton: 'Liên hệ chuyên gia',
                    ctaLinkHref: 'dang-ky.html'
                };
            }
        }
        
        calculateBtn.addEventListener('click', () => {
            const ageInput = document.getElementById('age');
            const heightInput = document.getElementById('height');
            const weightInput = document.getElementById('weight');
            if (!ageInput.value || !heightInput.value || !weightInput.value) {
                alert('Vui lòng điền đầy đủ thông tin Tuổi, Chiều cao và Cân nặng.');
                return;
            }
            calculateBtn.disabled = true;
            calculateBtn.textContent = 'Đang tính toán...';
            setTimeout(() => {
                welcomePanel.style.display = 'none';
                resultsContainer.classList.add('visible');
                const age = parseInt(ageInput.value);
                const gender = document.querySelector('input[name="gender"]:checked').value;
                const height = parseInt(heightInput.value);
                const weight = parseFloat(weightInput.value);
                const activityMultiplier = parseFloat(document.getElementById('activity').value);
                const bodyFat = parseFloat(document.getElementById('bodyfat').value);
                const bmi = (weight / ((height / 100) * (height / 100)));
                const bmiStatus = getBmiStatus(bmi);
                let bmr = 0;
                if (bodyFat && bodyFat > 0) {
                    bmr = 370 + (21.6 * (weight * (1 - bodyFat / 100)));
                } else {
                    if (gender === 'male') {
                        bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
                    } else {
                        bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
                    }
                }
                const tdee = bmr * activityMultiplier;
                const bmiValueEl = document.getElementById('bmi-value');
                const bmiInterpretationEl = document.getElementById('bmi-interpretation');
                const bmiProgressValue = document.getElementById('bmi-progress-value');
                animateDecimal(bmiValueEl, 0, bmi, 1500);
                bmiInterpretationEl.textContent = bmiStatus.text;
                bmiInterpretationEl.className = bmiStatus.className;
                document.getElementById('bmi-summary-text').textContent = bmiStatus.summary;
                const bmiPercent = Math.min(100, Math.max(0, ((bmi - 15) / (35 - 15)) * 100));
                setTimeout(() => {
                    bmiProgressValue.style.width = `${bmiPercent}%`;
                    bmiProgressValue.style.backgroundColor = `var(--${bmiStatus.className})`;
                }, 100);
                animateValue(document.getElementById('tdee-value'), 0, Math.round(tdee), 1500);
                animateValue(document.getElementById('bmr-value'), 0, Math.round(bmr), 1500);
                document.getElementById('bmi-warning').innerHTML = bmiStatus.warning;
                document.getElementById('bmi-action').innerHTML = bmiStatus.action;
                document.getElementById('bmi-recommendation').innerHTML = bmiStatus.recommendation;
                const macroGoals = {
                    "Giảm cân (thâm hụt ~15%)": tdee - (tdee * 0.15),
                    "Duy trì": tdee,
                    "Tăng cơ (dư thừa ~15%)": tdee + (tdee * 0.15)
                };
                const macroResultsBody = document.getElementById('macro-results-body');
                macroResultsBody.innerHTML = '';
                for (const goal in macroGoals) {
                    const calories = macroGoals[goal];
                    const protein = Math.round(weight * 2);
                    const fat = Math.round((calories * 0.25) / 9);
                    const carbs = Math.round((calories - (protein * 4) - (fat * 9)) / 4);
                    macroResultsBody.innerHTML += `
                        <tr>
                            <td class="goal-col">${goal}</td>
                            <td>${Math.round(calories).toLocaleString('vi-VN')}</td>
                            <td>${protein}</td>
                            <td>${carbs}</td>
                            <td>${fat}</td>
                        </tr>
                    `;
                }
                document.getElementById('cta-text').textContent = bmiStatus.ctaText;
                document.getElementById('cta-link').textContent = bmiStatus.ctaButton;
                document.getElementById('cta-link').href = bmiStatus.ctaLinkHref;
                calculateBtn.disabled = false;
                calculateBtn.textContent = 'Phân Tích Lại';
            }, 500);
        });

        const modal = document.getElementById('qr-modal');
        const donateButton = document.getElementById('donate-button');
        const closeButton = document.querySelector('.close-button');
        donateButton.onclick = function() { modal.style.display = "block"; }
        closeButton.onclick = function() { modal.style.display = "none"; }
        window.onclick = function(event) { if (event.target == modal) { modal.style.display = "none"; } }
    </script>
</body>
</html>

